<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Team" />
    <meta name="keywords" content="GridX, secure login, internal portal, authentication system, organization access" />
    <meta name="theme-color" content="#ffffff" />

    <!-- 🔗 Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Google Font: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://img.icons8.com/ios-filled/32/electrical.png" />
    <link rel="manifest" href="/manifest.json" />

    <!-- Bootstrap Icons CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <title>GridX - Secure Login</title>

    <style>
        /* Spinner overlay style */
        #pageLoader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            color: white;
            flex-direction: column;
            font-family: 'Inter', sans-serif;
        }

        .spinner {
            border: 6px solid #ffffff22;
            border-top: 6px solid #fff;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body
    class="h-screen w-full bg-cover bg-center bg-no-repeat transition-all duration-1000 overflow-hidden relative text-white font-inter">

    <!-- 🔄 Fullscreen Loader -->
    <div id="pageLoader">
        <div class="spinner"></div>
        <span class="text-lg">Loading, please wait...</span>
    </div>

    <!-- Background Overlay -->
    <div class="absolute inset-0 bg-black/20 animate-pulse z-0"></div>

    <!-- Login Form Container -->
    <main class="relative z-10 flex items-center justify-center min-h-screen px-4">
        <section aria-labelledby="login-heading">
            <form id="loginForm"
                class="bg-white/10 backdrop-blur-lg rounded-2xl p-8 w-full max-w-md shadow-lg flex flex-col animate-fadeInUp"
                role="form" autocomplete="off">
                <h2 id="login-heading" class="sr-only">Login to GridX</h2>

                <!-- Logo -->
                <div
                    class="bg-black text-white w-20 h-12 flex items-center justify-center text-2xl font-bold rounded-xl mx-auto mb-6">
                    GridX</div>

                <!-- Greeting -->
                <h2 id="greeting" class="text-center text-2xl font-semibold mb-2">Welcome Back!</h2>
                <p class="text-center text-gray-300 text-sm mb-6">Please enter your Email and Password to sign in.</p>

                <!-- Email Field -->
                <div class="mb-4 relative">
                    <label for="email" class="block text-sm mb-1">Email Address</label>
                    <input type="email" id="email" name="email" placeholder="name@example.com" required
                        autocomplete="username" aria-label="Email Address"
                        class="w-full py-3 pl-10 pr-4 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-400" />
                    <i class="bi bi-envelope absolute left-3 top-[2.65rem] text-gray-500"></i>
                </div>

                <!-- Password Field -->
                <div class="mb-4 relative">
                    <label for="password" class="block text-sm mb-1">Password</label>
                    <input type="password" id="password" name="password" placeholder="••••••••" required
                        autocomplete="current-password" aria-label="Password"
                        class="w-full py-3 pl-10 pr-10 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-400" />
                    <i class="bi bi-lock absolute left-3 top-[2.65rem] text-gray-500"></i>

                    <!-- Toggle Password -->
                    <button type="button" id="togglePassword" aria-label="Show password" aria-pressed="false"
                        class="absolute right-3 top-[2.3rem] text-gray-500 focus:outline-none">
                        <i class="bi bi-eye" title="Show/Hide Password"></i>
                    </button>
                    <div id="passwordStrength" class="text-xs mt-1"></div>
                </div>

                <!-- Remember + Forgot -->
                <div class="flex justify-between items-center text-sm text-gray-200 mb-4">
                    <label class="flex items-center"><input type="checkbox" id="remember" class="mr-2" /> Remember
                        Me</label>
                    <a href="forgot-password.html" class="hover:underline">Forgot Password?</a>
                </div>

                <!-- Sign In Button -->
                <button type="submit" id="loginBtn"
                    class="w-full py-3 bg-black text-white rounded-full hover:opacity-90 transition-transform active:scale-95 flex items-center justify-center">
                    <span id="btnText">Sign In</span>
                </button>

                <!-- Footer Text -->
                <div class="text-center text-gray-400 text-xs mt-3">
                    <i class="bi bi-shield-lock"></i> Secure Access Only
                </div>
            </form>
        </section>
    </main>

    <!-- JS Dependencies (use exact versions for stability) -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.4/dist/sweetalert2.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/zxcvbn@4.4.2/dist/zxcvbn.js"></script>

    <script>
        const loginForm = document.getElementById("loginForm");
        const emailInput = document.getElementById("email");
        const passwordInput = document.getElementById("password");
        const rememberCheckbox = document.getElementById("remember");
        const loginBtn = document.getElementById("loginBtn");
        const togglePassword = document.getElementById("togglePassword");
        const passwordStrength = document.getElementById("passwordStrength");
        const greeting = document.getElementById("greeting");
        const loader = document.getElementById("pageLoader");

        // 🔐 Sample Users
        const predefinedUsers = [
            { email: "admin@gridx.com", password: "admin123" },
            { email: "user@gridx.com", password: "user123" },
        ];

        let attemptCount = 0;

        // ⏳ Show Loader for 5 seconds
        window.addEventListener("DOMContentLoaded", () => {
            setTimeout(() => {
                loader.style.display = "none";
            }, 5000);
        });

        // 👋 Dynamic Greeting + Background
        const hour = new Date().getHours();
        if (hour < 5) {
            greeting.textContent = "Good Night!";
            document.body.style.backgroundImage = "url('/Frontend/pages/image/Night.jpg')";
        } else if (hour < 12) {
            greeting.textContent = "Good Morning!";
            document.body.style.backgroundImage = "url('/Frontend/pages/image/morning.jpg')";
        } else if (hour < 17) {
            greeting.textContent = "Good Afternoon!";
            document.body.style.backgroundImage = "url('/Frontend/pages/image/Afternoon.jpg')";
        } else if (hour < 20) {
            greeting.textContent = "Good Evening!";
            document.body.style.backgroundImage = "url('/Frontend/pages/image/Evening.jpg')";
        } else {
            greeting.textContent = "Good Night!";
            document.body.style.backgroundImage = "url('/Frontend/pages/image/Night.jpg')";
        }

        // 📶 Connectivity & Remember Email
        window.addEventListener("load", () => {
            emailInput.focus();
            if (!navigator.onLine) {
                Swal.fire("You are offline", "Please check your internet connection.", "warning");
            }
            const rememberedEmail = localStorage.getItem("rememberedEmail");
            if (rememberedEmail) {
                emailInput.value = rememberedEmail;
                rememberCheckbox.checked = true;
            }
        });

        window.addEventListener("offline", () => {
            Swal.fire("Offline Mode", "You lost internet connectivity.", "warning");
        });

        window.addEventListener("online", () => {
            Swal.fire("Back Online", "You're now reconnected.", "success");
        });

        // 👁 Toggle Password Visibility
        togglePassword.addEventListener("click", () => {
            const isPassword = passwordInput.type === "password";
            passwordInput.type = isPassword ? "text" : "password";
            togglePassword.firstElementChild.classList.toggle("bi-eye");
            togglePassword.firstElementChild.classList.toggle("bi-eye-slash");
        });

        // 📈 Password Strength Meter
        passwordInput.addEventListener("input", () => {
            const score = zxcvbn(passwordInput.value).score;
            const strength = ["Too Weak", "Weak", "Fair", "Good", "Strong"][score];
            const colors = ["#f00", "#f90", "#ff0", "#9f0", "#0f0"];
            passwordStrength.textContent = `Strength: ${strength}`;
            passwordStrength.style.color = colors[score];
        });

        // ✅ Handle Form Submit
        loginForm.addEventListener("submit", (event) => {
            event.preventDefault();

            if (!emailInput.checkValidity()) {
                Swal.fire("Invalid Email", "Please enter a valid email address.", "error");
                return;
            }

            loginBtn.disabled = true;
            loginBtn.innerHTML = `<span class="animate-spin mr-2">🔄</span>Authenticating...`;

            setTimeout(() => {
                loginBtn.disabled = false;
                loginBtn.innerHTML = "Sign In";

                const match = predefinedUsers.find(
                    (u) => u.email === emailInput.value && u.password === passwordInput.value
                );

                if (match) {
                    if (rememberCheckbox.checked) {
                        localStorage.setItem("rememberedEmail", emailInput.value);
                    } else {
                        localStorage.removeItem("rememberedEmail");
                    }

                    if (match.email === "admin@gridx.com") {
                        Swal.fire("MFA Required", "Check your inbox for a verification code.", "info");
                    }

                    // 🎉 Confetti Animation
                    const confettiCanvas = document.createElement("canvas");
                    confettiCanvas.id = "confettiCanvas";
                    confettiCanvas.style.position = "fixed";
                    confettiCanvas.style.top = "0";
                    confettiCanvas.style.left = "0";
                    confettiCanvas.style.width = "100%";
                    confettiCanvas.style.height = "100%";
                    confettiCanvas.style.pointerEvents = "none";
                    document.body.appendChild(confettiCanvas);

                    const confettiInstance = confetti.create(confettiCanvas, { resize: true });
                    confettiInstance({ spread: 70, origin: { y: 0.6 } });

                    Swal.fire("Login Successful", "", "success").then(() => {
                        loader.style.display = "flex"; // show loader before navigating
                        setTimeout(() => {
                            window.location.href = "dashboard.html";
                        }, 5000);
                    });

                } else {
                    attemptCount++;
                    loginForm.classList.add("animate-shake");
                    setTimeout(() => loginForm.classList.remove("animate-shake"), 500);

                    if (attemptCount >= 5) {
                        loginBtn.disabled = true;
                        Swal.fire("Too Many Attempts", "Try again later.", "error");
                    } else {
                        Swal.fire("Oops", "Email not found or incorrect password.", "error");
                    }
                }
            }, 1000);
        });

        // 🧪 Developer Shortcut to Show Test Users
        document.addEventListener("keydown", (e) => {
            if (e.ctrlKey && e.key === "d") {
                e.preventDefault();
                Swal.fire(
                    "Test Users",
                    "admin@gridx.com / admin123\nuser@gridx.com / user123",
                    "info"
                );
            }
        });
    </script>
</body>

</html>